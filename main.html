<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyOtt</title>
<link rel="manifest" href="manifest.json"><link rel="stylesheet" href="assets/style.css"><script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script></head><body>
<div class="bg-flag"></div>
<header class="header"><div class="brand"><img src="assets/logo.png" class="logo"><div><div class="title">MyOtt</div><div class="subtitle">Al-Muktafi Billah Shah</div></div></div>
<div class="controls"><input id="playlistUrl" placeholder="Enter M3U / M3U8 URL"><button id="load">Load</button></div></header>
<main class="content"><div id="now" class="small">Loading...</div><div class="grid" id="grid"></div>
<div id="player" class="player"><video id="video" controls playsinline></video></div></main>
<script>
const DEFAULT='https://raw.githubusercontent.com/PuteraPerlis74/Tv/refs/heads/main/MYTV.m3u';
let channels=[];
const grid=document.getElementById('grid'), video=document.getElementById('video'), player=document.getElementById('player');
function parseM3U(t){const lines=t.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);let items=[],last=null;for(let line of lines){if(line.startsWith('#EXTINF')){let i=line.indexOf(',');last=i!==-1?line.slice(i+1).trim():line;} else if(!line.startsWith('#')){if(last){items.push({title:last,url:line});last=null;} else items.push({title:line,url:line});}}return items;}
function render(){grid.innerHTML=''; if(!channels.length){document.getElementById('now').textContent='No channels loaded'; return;} channels.forEach((c,i)=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<div class="thumb"><div style="color:white">${c.title.slice(0,2).toUpperCase()}</div></div><div class="meta"><div class="name">${c.title}</div><div class="sub">${c.url}</div></div>`;card.addEventListener('click',()=>onSelect(i));grid.appendChild(card);});}
async function loadUrl(u){try{const r=await fetch(u);if(!r.ok)throw new Error('fetch '+r.status);const t=await r.text();channels=parseM3U(t);localStorage.setItem('myott_m3u',t);render();}catch(e){alert('Failed to load: '+e.message)}}
function onSelect(i){const c=channels[i];if(!c) return; const ext=confirm('Play in external player? (OK = External, Cancel = Play here)'); if(ext){window.open(c.url,'_blank');return;} // play in-app via HLS
player.style.display='block'; if(window.Hls && Hls.isSupported()){if(window._hls){try{window._hls.destroy();}catch(e){}window._hls=null;} window._hls=new Hls(); window._hls.loadSource(c.url); window._hls.attachMedia(video); window._hls.on(Hls.Events.MANIFEST_PARSED, ()=> video.play().catch(()=>{}));} else {video.src=c.url; video.play().catch(()=>{});}}
document.getElementById('load').addEventListener('click', ()=> loadUrl(document.getElementById('playlistUrl').value.trim() || DEFAULT));
window.addEventListener('load', ()=>{const last=localStorage.getItem('myott_m3u'); if(last){channels=parseM3U(last); render();} else loadUrl(DEFAULT);});
if('serviceWorker' in navigator){navigator.serviceWorker.register('/service-worker.js').catch(()=>{});}
</script>
</body></html>