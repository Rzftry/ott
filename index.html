<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyOtt Ultimate</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {margin:0; font-family:"Poppins",sans-serif; background:linear-gradient(135deg, rgba(0,32,91,0.8), rgba(255,204,0,0.7)), url('https://upload.wikimedia.org/wikipedia/commons/6/66/Flag_of_Malaysia.svg'); background-size:cover; background-attachment:fixed; color:#fff;}
header{text-align:center; padding:15px; font-size:2em; font-weight:300; letter-spacing:2px; color:#fff; text-shadow:0 0 10px rgba(0,0,0,0.6);}
#fileContainer, #manualContainer{padding:10px 15px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
#fileContainer input[type=file], #manualContainer input[type=text]{flex:1; padding:6px 10px; border-radius:8px; border:none; color:#000;}
#fileContainer button, #manualContainer button{padding:6px 12px; border-radius:8px; border:none; cursor:pointer; background:#00a8ff; color:#fff;}
#filterContainer, #searchContainer, #tabContainer{padding:0 15px; margin-bottom:10px;}
#searchContainer input{width:100%; padding:6px 10px; border-radius:8px; border:none;}
#tabContainer button{padding:6px 12px; border-radius:8px; border:none; cursor:pointer; margin-right:6px; background:rgba(255,255,255,0.1); color:#fff;}
#tabContainer button.active{background:#00a8ff;}
#main{display:flex; flex-direction:row; height:calc(100vh - 220px);}
#leftPanel{width:35%; overflow-y:auto; padding:15px; border-right:1px solid rgba(255,255,255,0.2);}
#rightPanel{flex:1; padding:15px; display:flex; flex-direction:column; justify-content:flex-start;}
.channel{background:rgba(255,255,255,0.1); border-radius:12px; padding:6px; margin:6px 0; cursor:pointer; transition:0.3s; display:flex; justify-content:space-between; align-items:center;}
.channel:hover{background:rgba(255,255,255,0.25); transform:scale(1.02);}
.channel .thumb{width:40px; height:25px; background:rgba(0,0,0,0.3); margin-right:6px; flex-shrink:0; border-radius:4px;}
.channel span.name{flex:1;}
.category-header{font-weight:600; font-size:1.1rem; padding:6px 12px; border-radius:12px; margin:15px 0 8px 0; display:flex; justify-content:space-between; align-items:center;}
#player{width:100%; flex:1; border-radius:12px; background:rgba(0,0,0,0.6);}
.hide-btn{background:rgba(255,255,255,0.1); border:none; color:#fff; padding:2px 6px; border-radius:8px; cursor:pointer;}
.hide-btn:hover{background:rgba(255,255,255,0.3);}
@media(max-width:900px){#main{flex-direction:column; height:calc(100vh - 280px);} #leftPanel{width:100%; height:40%; border-right:none; border-bottom:1px solid rgba(255,255,255,0.2);} #rightPanel{height:60%;}}
</style>
</head>
<body>
<header>MyOtt Ultimate</header>

<div id="fileContainer">
<input type="file" id="playlistFile" accept=".m3u,.txt">
<button id="loadBtn">Load Playlist</button>
</div>

<div id="manualContainer">
<input type="text" id="manualName" placeholder="Nama Channel">
<input type="text" id="manualURL" placeholder="URL Stream (.m3u8/mp4)">
<select id="manualType">
  <option value="live">Live</option>
  <option value="vod">VOD</option>
  <option value="movie">Movie</option>
</select>
<button id="addManualBtn">Tambah Channel</button>
</div>

<div id="searchContainer">
<input type="text" id="searchInput" placeholder="Cari channel...">
</div>

<div id="filterContainer">
<label><input type="checkbox" id="filterPlayable"> Tunjuk hanya channel boleh main di Chrome</label>
</div>

<div id="tabContainer">
<button class="tabBtn active" data-type="all">Semua</button>
<button class="tabBtn" data-type="live">Live</button>
<button class="tabBtn" data-type="vod">VOD</button>
<button class="tabBtn" data-type="movie">Movie</button>
</div>

<div id="main">
<div id="leftPanel">Pilih fail M3U dahulu atau tambah manual channel...</div>
<div id="rightPanel"><video id="player" controls autoplay></video></div>
</div>

<script>
const filterCheckbox = document.getElementById("filterPlayable");
const loadBtn = document.getElementById("loadBtn");
const playlistFile = document.getElementById("playlistFile");
const searchInput = document.getElementById("searchInput");
const tabBtns = document.querySelectorAll(".tabBtn");
const addManualBtn = document.getElementById("addManualBtn");
let allChannelDivs = [];

// Load local file
loadBtn.addEventListener("click", ()=>{
  if(playlistFile.files.length===0){
    alert("Sila pilih fail M3U dahulu!");
    return;
  }
  const file = playlistFile.files[0];
  const reader = new FileReader();
  reader.onload = function(e){
    parsePlaylist(e.target.result);
  };
  reader.readAsText(file);
});

// Add manual channel
addManualBtn.addEventListener("click", ()=>{
  const name = document.getElementById("manualName").value.trim();
  const url = document.getElementById("manualURL").value.trim();
  const type = document.getElementById("manualType").value;
  if(!name || !url){ alert("Sila isi nama dan URL"); return;}
  addChannel({name,url,type});
  document.getElementById("manualName").value="";
  document.getElementById("manualURL").value="";
});

function parsePlaylist(text){
  const lines = text.split("\n");
  const container = document.getElementById("leftPanel");
  container.innerHTML="";
  allChannelDivs=[];

  const categories={};

  for(let i=0;i<lines.length;i++){
    const line = lines[i].trim();
    if(line.startsWith("#EXTINF")){
      const nameMatch = line.match(/tvg-name="([^"]+)"/);
      const groupMatch = line.match(/group-title="([^"]+)"/);
      let name = nameMatch ? nameMatch[1] : line.split(",")[1];
      let group = groupMatch ? groupMatch[1] : "Saluran Umum";
      let typeClass="live";
      const lowerGroup = group.toLowerCase();
      if(lowerGroup.includes("vod")) typeClass="vod";
      else if(lowerGroup.includes("movie")) typeClass="movie";

      let channelUrl="";
      for(let j=i+1;j<lines.length;j++){
        const nextLine = lines[j].trim();
        if(nextLine && nextLine.startsWith("http")){channelUrl=nextLine; break;}
      }

      if(!categories[group]) categories[group]={type:typeClass, channels:[]};
      categories[group].channels.push({name:name,url:channelUrl,type:typeClass});
    }
  }

  Object.keys(categories).sort().forEach(group=>{
    const cat = categories[group];
    const header = document.createElement("div");
    header.classList.add("category-header");
    header.innerHTML = `<span>${group}</span> <button class="hide-btn">Hide</button>`;
    const channelContainer = document.createElement("div");
    channelContainer.classList.add("channel-group");

    cat.channels.sort((a,b)=>a.name.localeCompare(b.name)).forEach(ch=>{
      addChannel(ch, channelContainer);
    });

    header.querySelector(".hide-btn").onclick = ()=>{
      channelContainer.style.display = channelContainer.style.display==="none"?"block":"none";
    };

    document.getElementById("leftPanel").appendChild(header);
    document.getElementById("leftPanel").appendChild(channelContainer);
  });
}

// Add a single channel
function addChannel(ch, parent=null){
  const channelDiv = document.createElement("div");
  channelDiv.classList.add("channel");
  const playable = isPlayable(ch.url);
  channelDiv.innerHTML = `<div class="thumb"></div><span class="name">${ch.name}</span> <span>${playable?"✅":"❌"}</span>`;
  channelDiv.onclick = ()=>playChannel(ch.url);
  channelDiv.dataset.playable = playable;
  channelDiv.dataset.type = ch.type;
  (parent||document.getElementById("leftPanel")).appendChild(channelDiv);
  allChannelDivs.push(channelDiv);
  applyFilters();
}

function isPlayable(url){
  if(!url) return false;
  const ext = url.split("?")[0].split(".").pop().toLowerCase();
  return ["mp4","webm","ogg","m3u8"].includes(ext);
}

filterCheckbox.addEventListener("change", applyFilters);
searchInput.addEventListener("input", applyFilters);
tabBtns.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    tabBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    applyFilters();
  });
});

function applyFilters(){
  const showOnlyPlayable = filterCheckbox.checked;
  const searchText = searchInput.value.toLowerCase();
  const activeTab = document.querySelector(".tabBtn.active").dataset.type;

  allChannelDivs.forEach(div=>{
    let show = true;
    if(showOnlyPlayable && div.dataset.playable==="false") show=false;
    if(searchText && !div.querySelector(".name").textContent.toLowerCase().includes(searchText)) show=false;
    if(activeTab!=="all" && div.dataset.type!==activeTab) show=false;
    div.style.display = show?"flex":"none";
  });
}

function playChannel(url){
  if(!url) return alert("Tiada URL untuk saluran ini.");
  const player = document.getElementById("player");
  if(Hls.isSupported() && url.endsWith(".m3u8")){
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(player);
    player.play();
  } else {
    player.src = url;
    player.play();
  }
}
</script>
</body>
</html>
                                
